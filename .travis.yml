language: node_js
node_js:
  - "lts/*"
install:
  - pushd server
  - npm ci
  - popd
  - pushd client
  - npm ci
  - popd
cache:
  directories:
    - ~/.npm
    - ~/.cache
  stages:
    - tests

jobs:
  include:
    - stage: tests
      name: Integration
      before_script:
        - pushd server & npm run start:test &
      script:
        - pushd client & npm run test -- --headless